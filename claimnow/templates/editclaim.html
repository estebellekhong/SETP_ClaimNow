{% extends 'layout.html' %}

{% block title %}Profile Management{% endblock %}

{% block content %}

<div class="home-section">
  <h1>View/Edit a Claim</h1>

  <form action="{{ url_for('edit') }}"  method="post">
    <div class="backgorund-container">
      <div class="row">

        <div class="col col-lg-1 "></div>
        <div class="col col-lg-4">
          <div class="row">
            <label for="basic-url">
              <h3>Claim Category</h3>
            </label>
            <div class="input-group-lg">
              <div class="input-group-prepend">
                <input class="form-control" type="text" id="Claim_category" name="Claim_category"
                  value="{{ claims.Claim_Category }}" readonly />
              </div>
            </div>
          </div>
          <div class="row">
            <label for="basic-url">
              <h3>Claim Date</h3>
            </label>
            <div class="input-group-lg">
              <div class="input-group-prepend">
                <input class="form-control" type="date" id="Claim_Date" name="Claim_Date"
                  value="{{ claims.Claim_Date }}" />
              </div>
            </div>
          </div>
          <div class="row">
            <label for="basic-url">
              <h3>Expenses Country</h3>
            </label>
            <div class="input-group-lg">
              <div class="input-group-prepend">
                <input class="form-control" type="text" id="Expense_Country" name="Expense_Country"
                  value="{{ claims.Country_of_Exp }}">
              </div>
            </div>
          </div>

          <div class="row">
            <label for="basic-url">
              <h3>Claim Description</h3>
            </label>
            <div class="input-group-lg">
              <div class="input-group-prepend">
                <textarea class="form-control" spellcheck="true" id="Claim_Desc" name="Claim_Desc"
                  rows="8">{{ claims.Claim_Desc }}</textarea>
              </div>
            </div>
          </div>
        </div>

        <div class="col col-lg-1"></div>

        <div class="col col-lg-4">

          <div class="row">
            <label for="basic-url">
              <h3>Amount</h3>
            </label>
            <div class="input-group-lg">
              <div class="input-group-prepend">
                <input class="form-control"  type="number" step="0.05" id="Foreign_Currency" name="Foreign_Currency" required min='0.05'
                  value="{{ claims.Claim_Amount_FC }}" />
                </select>
              </div>
            </div>
          </div>

          <div class="row">
            <div class="drop-list">
              <div class="form">
                <div class="col-4 col-md-4">
                  <p>From</p>
                  <div class="select-box2">

                    <img src="https://flagcdn.com/48x36/sg.png" alt="flag" id="img" name="img">
                    <select id="primary" name="primary"></select>

                  </div>
                </div>
                <div class="col-1  col-md-1"></div>

                <div class="col-2  col-md-2">
                  <div class="icon"><i class="fas fa-exchange-alt"></i></div>
                </div>
                <div class="col-1  col-md-1"></div>
                <div class="col-4  col-md-4">
                  <p>To</p>
                  <div class="select-box2">
                    <img src="https://flagcdn.com/48x36/sg.png" alt="flag" id="img" name="img">
                    <select id="secondary" name="secondary"></select>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <br>
          <div class="row">
            <input class="btn-primary" id="btn-convert" type="button" value="Get Exchange Rate" />
          </div>

          <div class="row">
            <p>
              <span id="txt-primary"></span>
              <span id="txt-secondary"></span>
            </p>
          </div>

          <div class="row">
            <label for="basic-url">
              <h3>Expense Amount (Foreign Currency)</h3>
            </label>
            <div class="input-group-lg">
              <div class="input-group-prepend">
                <input class="form-control" type="text" id="Claim_Amount_FC" name="Claim_Amount_FC"
                  value="{{ claims.Claim_Amount_FC }}" required readonly/>
              </div>
            </div>
          </div>

          <div class="row">
            <label for="basic-url">
              <h3>Expense Amount (SGD)</h3>
            </label>
            <div class="input-group-lg">
              <div class="input-group-prepend">
                <input class="form-control" type="text" id="Claim_Amount_SGD" name="Claim_Amount_SGD"
                  value="{{ claims.Claim_Amount_SGD }}" required readonly/>
              </div>
            </div>
          </div>

          <div class="row">
            <label for="basic-url">
              <h3>Conversion Rate</h3>
            </label>
            <div class="input-group-lg">
              <div class="input-group-prepend">
                <input class="form-control" type="text" id="conversion_rate" name="conversion_rate"
                  value="{{ claims.Forex }}" required readonly/>
              </div>
            </div>
          </div>

          <br>
          <div class="row">
            <div class="input-group-lg">
              <div class="input-group-prepend">
                <input type="hidden" name="ClaimID" id="Claim_ID" value="{{ claims.ClaimID }}" />
                <button class="btn-warning" type="submit">Save Claim</button>
              </div>
            </div>
          </div>
        </div>
        <div class="col col-lg-2"></div>
      </div>
    </div>
  </form>

</div>
<!--Script for function-->
<script>
  let country_list = {
    "AED": "AE",
    "AFN": "AF",
    "XCD": "AG",
    "ALL": "AL",
    "AMD": "AM",
    "ANG": "AN",
    "AOA": "AO",
    "AQD": "AQ",
    "ARS": "AR",
    "AUD": "AU",
    "AZN": "AZ",
    "BAM": "BA",
    "BBD": "BB",
    "BDT": "BD",
    "XOF": "BE",
    "BGN": "BG",
    "BHD": "BH",
    "BIF": "BI",
    "BMD": "BM",
    "BND": "BN",
    "BOB": "BO",
    "BRL": "BR",
    "BSD": "BS",
    "NOK": "BV",
    "BWP": "BW",
    "BYR": "BY",
    "BZD": "BZ",
    "CAD": "CA",
    "CDF": "CD",
    "XAF": "CF",
    "CHF": "CH",
    "CLP": "CL",
    "CNY": "CN",
    "COP": "CO",
    "CRC": "CR",
    "CUP": "CU",
    "CVE": "CV",
    "CYP": "CY",
    "CZK": "CZ",
    "DJF": "DJ",
    "DKK": "DK",
    "DOP": "DO",
    "DZD": "DZ",
    "ECS": "EC",
    "EEK": "EE",
    "EGP": "EG",
    "ETB": "ET",
    "EUR": "FR",
    "FJD": "FJ",
    "FKP": "FK",
    "GBP": "GB",
    "GEL": "GE",
    "GGP": "GG",
    "GHS": "GH",
    "GIP": "GI",
    "GMD": "GM",
    "GNF": "GN",
    "GTQ": "GT",
    "GYD": "GY",
    "HKD": "HK",
    "HNL": "HN",
    "HRK": "HR",
    "HTG": "HT",
    "HUF": "HU",
    "IDR": "ID",
    "ILS": "IL",
    "INR": "IN",
    "IQD": "IQ",
    "IRR": "IR",
    "ISK": "IS",
    "JMD": "JM",
    "JOD": "JO",
    "JPY": "JP",
    "KES": "KE",
    "KGS": "KG",
    "KHR": "KH",
    "KMF": "KM",
    "KPW": "KP",
    "KRW": "KR",
    "KWD": "KW",
    "KYD": "KY",
    "KZT": "KZ",
    "LAK": "LA",
    "LBP": "LB",
    "LKR": "LK",
    "LRD": "LR",
    "LSL": "LS",
    "LTL": "LT",
    "LVL": "LV",
    "LYD": "LY",
    "MAD": "MA",
    "MDL": "MD",
    "MGA": "MG",
    "MKD": "MK",
    "MMK": "MM",
    "MNT": "MN",
    "MOP": "MO",
    "MRO": "MR",
    "MTL": "MT",
    "MUR": "MU",
    "MVR": "MV",
    "MWK": "MW",
    "MXN": "MX",
    "MYR": "MY",
    "MZN": "MZ",
    "NAD": "NA",
    "XPF": "NC",
    "NGN": "NG",
    "NIO": "NI",
    "NPR": "NP",
    "NZD": "NZ",
    "OMR": "OM",
    "PAB": "PA",
    "PEN": "PE",
    "PGK": "PG",
    "PHP": "PH",
    "PKR": "PK",
    "PLN": "PL",
    "PYG": "PY",
    "QAR": "QA",
    "RON": "RO",
    "RSD": "RS",
    "RUB": "RU",
    "RWF": "RW",
    "SAR": "SA",
    "SBD": "SB",
    "SCR": "SC",
    "SDG": "SD",
    "SEK": "SE",
    "SGD": "SG",
    "SKK": "SK",
    "SLL": "SL",
    "SOS": "SO",
    "SRD": "SR",
    "STD": "ST",
    "SVC": "SV",
    "SYP": "SY",
    "SZL": "SZ",
    "THB": "TH",
    "TJS": "TJ",
    "TMT": "TM",
    "TND": "TN",
    "TOP": "TO",
    "TRY": "TR",
    "TTD": "TT",
    "TWD": "TW",
    "TZS": "TZ",
    "UAH": "UA",
    "UGX": "UG",
    "USD": "US",
    "UYU": "UY",
    "UZS": "UZ",
    "VEF": "VE",
    "VND": "VN",
    "VUV": "VU",
    "YER": "YE",
    "ZAR": "ZA",
    "ZMK": "ZM",
    "ZWD": "ZW"
  }

  const droplist = document.querySelectorAll(".drop-list select");
  const primaryCurrency = document.getElementById("primary");
  const secondaryCurrency = document.getElementById("secondary");
  const country_code = country_list
  primaryCurrency.innerHTML = getOptions(country_list);
  secondaryCurrency.innerHTML = getOptions(country_list);


  function getOptions(data) {
    return Object.entries(data)
      .map(([country, currency]) => `<option value="${country}">${country}</option>`)
      .join("");
  }

  document.getElementById("btn-convert").addEventListener("click", fetchCurrencies);

  function fetchCurrencies() {
    const primary = primaryCurrency.value;
    const secondary = secondaryCurrency.value;
    const amount = document.getElementById("Foreign_Currency").value;
    const fc = document.getElementById("Claim_Amount_FC").value;
    // Important: Include your API key below
    fetch("https://v6.exchangerate-api.com/v6/10e6be3a3cbd346c984a5c01/latest/" + primary)
      .then((response) => {
        if (response.ok) {
          return response.json();
        } else {
          throw new Error("NETWORK RESPONSE ERROR");
        }
      })
      .then((data) => {
        console.log(data);
        displayCurrency(data, primary, secondary, amount);
      })
      .catch(() => {
        exchangeRateTxt.innerText = "Something went wrong";
      });
  }

  function displayCurrency(data, primary, secondary, amount) {
    const calculated = amount * data.conversion_rates[secondary];
    const forex = data.conversion_rates[secondary]
    const ori = amount
    document.getElementById("txt-primary").innerText = amount + " " + primary + " = ";
    document.getElementById("conversion_rate").value = forex;
    document.getElementById("txt-secondary").innerText = calculated + " " + secondary;
    document.getElementById("Claim_Amount_SGD").value = calculated.toFixed(2);
    document.getElementById("Claim_Amount_FC").value = amount;
  }

  for (let i = 0; i < droplist.length; i++) {
    for (let country_list in country_code) {
      let selected;
      if (i == 0) {
        selected = country_list == "SGD" ? "selected" : "";
      } else if (i == 1) {
        selected = country_list == "SGD" ? "selected" : "";
      }
      let optionTag = `<option value="${country_list}" ${selected}>${country_list}</option>`;
      droplist[i].insertAdjacentHTML("beforeend", optionTag)
    }
    droplist[i].addEventListener("change", e => {
      loadFlag(e.target)
    });

  }



  function loadFlag(e) {
    for (code in country_list) {
      if (code == e.value) {
        const country = country_list[code].toLowerCase();
        let imgTag = e.parentElement.querySelector('img')
        imgTag.src = `https://flagcdn.com/48x36/${country}.png`;
        imgTag.srcset = `https://flagcdn.com/96x72/${country}.png 2x, https://flagcdn.com/144x108/${country}.png 3x`;
        imgTag.alt = country;
      }
    }
  }

  const exchangeIcon = document.querySelector("form .icon");
  exchangeIcon.addEventListener("click", () => {
    let tempCode = primaryCurrency.value;
    primaryCurrency.value = secondaryCurrency.value;
    secondaryCurrency.value = tempCode;
    loadFlag(primaryCurrency);
    loadFlag(secondaryCurrency);
    getExchangeRate();
  })

</script>

<!--Script for function-->
<script>
  let sidebar = document.querySelector(".sidebar");
  let closeBtn = document.querySelector("#btn");
  let searchBtn = document.querySelector(".bx-search");

  closeBtn.addEventListener("click", () => {
    sidebar.classList.toggle("open");
    menuBtnChange();//calling the function(optional)
  });

  //searchBtn.addEventListener("click", () => { // Sidebar open when you click on the search iocn
  //  sidebar.classList.toggle("open");
  //  menuBtnChange(); //calling the function(optional)
  //});

  // following are the code to change sidebar button(optional)
  function menuBtnChange() {
    if (sidebar.classList.contains("open")) {
      closeBtn.classList.replace("bx-menu", "bx-menu-alt-right");//replacing the iocns class
    } else {
      closeBtn.classList.replace("bx-menu-alt-right", "bx-menu");//replacing the iocns class
    }
  }


</script>
{% endblock %}